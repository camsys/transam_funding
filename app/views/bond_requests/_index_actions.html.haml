- if can? :create, BondRequest
  .btn-group{style: 'margin-top:-2px;'}
    = link_to new_bond_request_path, :class => 'btn btn-default' do
      %i.fa.fa-plus.fa-fw
      = "Add Bond Request"

= form_tag bond_requests_path, :id => 'filter_form', :method => "get", :class => 'navbar-form navbar-right panel-action', style: 'padding-top: 1px' do
  .form-group
    = select_tag(:state_filter, options_for_select(BondRequest.state_names.collect{|a| [a.titleize, a]}, :selected => @request_state), :class => "form-control", :multiple => true)
  .form-group
    = select_tag(:submitted_at_filter, options_for_select(BondRequest.where('submitted_at IS NOT NULL').pluck(:submitted_at).collect{|d| [format_as_date(d.to_date), d.to_date]}.uniq, :selected => @submitted_at), :class => "form-control", :prompt => "Any Submission Date...", :disabled => true)

  = button_tag :class => 'btn btn-default', :type => 'submit' do
    %i.fa.fa-filter


:javascript

  $(document).ready(function() {

    $('#state_filter').multiselect({
      inheritClass: true,
      maxHeight: 250,
      buttonText: function(options, select) {
        if (options.length === 0) {
          return 'Any Status...';
        } else {
          return 'Status - ' + options.length + ' selected';
        }
      }
    });

    $('#state_filter').change();

  });

  $('#state_filter').on('change', function(e) {
    filtered = $('#state_filter').val();
    if (filtered && filtered.length == 1 && filtered.indexOf('submitted') > -1) {
      $('#submitted_at_filter').prop('disabled', false);
    } else {
      $('#submitted_at_filter').prop('disabled', true);
    }
  });

