<script type="text/javascript">

	google.load('visualization', '1.0', {'packages':['corechart']});

	var div_id = '<%= "chart_#{@report.id}" %>';
	var chart_type = '<%= @report.chart_type %>';
	var chart_options = <%= raw(@report.chart_options) %>;

	google.setOnLoadCallback(draw_chart);

	function draw_chart() {  
		var chart_data = new google.visualization.DataTable();
		
  		chart_data.addColumn('string', '<%= @data[:labels].first %>');
  		<% @data[:labels].last(@data[:labels].length - 1).each do |col| %>
  			chart_data.addColumn('number', '<%= col %>');
  		<% end %>
		
		<% @data[:data].each do |row| %>
			chart_data.addRow([
				<% row.each_with_index do |el, idx| %>
					<% if idx == 0 %>
						'<%= row[idx] %>' 
					<% else %>
						,{v: <%= row[idx].to_i %>, f: '<%= format_as_currency(row[idx]) %>'} 
					<% end %>
				<% end %>
			]);
		<% end %>
  
  		transam.draw_chart(div_id, chart_type, chart_options, chart_data);	
	};


  	// load the contents for the budget-editing modal when it is shown
  	$('#budget-edit-modal').on('shown.bs.modal', function(e) {
    	$('#budget-edit-modal').load(
    		'/budgets/alter', 
    		{'id': $(e.relatedTarget).data('id')}
    	);
  	});
	
	// Handle the resize event and make sure the chart is redrawn for the new size
	window.onresize = function() {
		draw_chart();
	};
  
  	$(document).ready(function() {

    	draw_chart();
	    
  	});
</script>


