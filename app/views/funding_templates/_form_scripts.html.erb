<script type="text/javascript">

  // Document Ready
  $(document).ready(function(){

  	var owner_org_selected_set_name = 'funding_template_organization_ids';
  	var owner_org_shuttle_target_id = 'selected_owner_orgs';
    var contributor_org_selected_set_name = 'funding_template_contributor_organization_ids';
    var contributor_org_shuttle_target_id = 'selected_contributor_orgs';

  	// Add an submit event handler for the form
  	$(".funding_template_form").submit(function(){
      if ($(this).valid()) {
        var owner_org_shuttle_target = $('#' + owner_org_shuttle_target_id);
        // select all the options in the selected array from the other shuttle list list
        var id_list = new Array();
        owner_org_shuttle_target.children().map(function () {
          id_list.push($(this).val());
        });
        //var id_list = new Array();
        //alert(id_list);
        $('input[name="funding_template[organization_ids][]"]').each(function ( index, element ) {
            if ($.inArray($(element).val(), id_list) == -1) {
                $(element).val('');
            }
        });


        var contributor_org_shuttle_target = $('#' + contributor_org_shuttle_target_id);
        // select all the options in the selected array from the other shuttle list list
        var id_list = new Array();
        contributor_org_shuttle_target.children().map(function () {
            id_list.push($(this).val());
        });
        //var id_list = new Array();
        //alert(id_list);
        $('input[name="funding_template[contributor_organization_ids][]"]').each(function ( index, element ) {
            if ($.inArray($(element).val(), id_list) == -1) {
                $(element).val('');
            }
        });

        return true;
      }
  	});

    var t = $('#owner_org_select').bootstrapTransfer({
    	target_id: owner_org_shuttle_target_id,
     	hilite_selection: false
     });
    var filter_orgs = [];
    var selected = [];
    <% Organization.where('id IN (?) AND organization_type_id != ?', @organization_list, OrganizationType.find_by(class_name: 'PlanningPartner').id).each do |org| %>
      filter_orgs.push({value: '<%= org.id %>', content: '<%= org.coded_name %>'});
    <% end %>

    <% @funding_template.organizations.each do |grantee| %>
      selected.push('<%= grantee.id %>');
    <% end %>
    
    t.populate(filter_orgs);
    t.set_values(selected);

    var contributor_multiselector = $('#contributor_org_select').bootstrapTransfer({
        target_id: contributor_org_shuttle_target_id,
        hilite_selection: false
    });
    var filter_orgs = [];
    var selected = [];
    <% Organization.where('id IN (?) AND organization_type_id != ?', @organization_list, OrganizationType.find_by(class_name: 'PlanningPartner').id).each do |org| %>
    filter_orgs.push({value: '<%= org.id %>', content: '<%= org.coded_name %>'});
    <% end %>

    <% @funding_template.contributor_organizations.each do |grantee| %>
    selected.push('<%= grantee.id %>');
    <% end %>

    contributor_multiselector.populate(filter_orgs);
    contributor_multiselector.set_values(selected);

    transam.make_same_height('.form-part');
  });


</script>
